<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Draw</title>
	<link rel="stylesheet" href="cancer.css">
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.5/jscolor.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
	<script src="cancerCursors.js" defer></script>
	<style>

#drawingCanvas {
  cursor: url('cursors/1.png'), auto; 
}


	</style>
</head>

<body>

	<main class="base-container">
		<aside class="sidebar">
			<a href="../index.html" target="_self" title="–í—ã–π—Ç–∏ –∏–∑ –∫–æ–º–∞–Ω—Ç—ã" id="exitLink"
				style="font-size: 50px;">üö™</a>
			<div id="message-container" style="display: none;">
				<p id="message"></p>
			</div>
			<input type="file" id="imageInput" accept="image/*" style="display: none;">
			<button id="undo" title="–û—Ç–º–µ–Ω–∏—Ç—å (Z)">‚ü≤</button>
			<button id="redo" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (X)">‚ü≥</button>
			<button id="symmetry" title="–°–∏–º–º–µ—Ç—Ä–∏—è (S)">ü¶ã</button>
			<button id="eyedropperBtn" title="–ü–∏–ø–µ—Ç–∫–∞ –∑–∞–ª–∏–≤–∫–∏ (A)">üíß</button>
			<button id="changeCursorBtn" title="–°–º–µ–Ω–∏—Ç—å –∫—É—Ä—Å–æ—Ä">üé®</button>
			<button id="clearBtn" title="–û—á–∏—Å—Ç–∏—Ç—å">üíÄ</button>
			<button id="saveImageBtn" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">üíæ</button>
			<!-- <button id="eraserBtn" title="–°—Ç–µ—Ä–∫–∞">üßΩ</button> -->
			<button id="eraserBtn" title="–°—Ç–µ—Ä–∫–∞">
				<img src="cursors/2.png" alt="–°—Ç–µ—Ä–∫–∞" width="50">
		</aside>
		<div class="canvas-and-sliders">
			<div class="canvas-container">
				<div class="color-picker-group">
					<input type="color" id="colorPicker" value="#000000" title="–¶–≤–µ—Ç –∑–∞–ª–∏–≤–∫–∏ (C)">
					<input type="color" id="backgroundPicker" value="#ffffff" title="–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (B)">
					<button id="previousWord" title="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–ª–æ–≤–æ">&lt;</button>
					<p id="Quizz"></p>
					<button id="nextWord" title="–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ">&gt;</button>
					<div id="elapsedTime" class="time"></div>
				</div>
				<div class="canv-container">
					<canvas id="backgroundCanvas" width="700" height="500"
						style="width:700px;height:500px; position: absolute; z-index: -1;"></canvas>
					<canvas id="drawingCanvas" width="700" height="500" style="width:700px;height:500px;">
					</canvas>
					<div id="cursorPanel" class="cursor-panel" style="display: none;">
						<div id="cursorList"></div>
					</div>
				</div>
			</div>
			<div class="slider-group">
				<div class="slider">
					<div class="pressure-bar" id="pressureBar"></div>
					<label for="brushSize" title="–†–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏">üñåÔ∏è</label>
					<input type="range" id="brushSize" min="1" max="100" value="1">
    <span class="slider-value" id="rangeValue">50</span> 

				</div>
			</div>
		</div>
	</main>
	<script>
		const colorPicker = document.getElementById('colorPicker');
		const backgroundPicker = document.getElementById('backgroundPicker');
		const drawingCanvas = document.getElementById('drawingCanvas');
		const backgroundCanvas = document.getElementById('backgroundCanvas');
		const ctx = drawingCanvas.getContext('2d');
		const bgCtx = backgroundCanvas.getContext('2d');
		const symmetryButton = document.getElementById('symmetry');
		const brushSizeInput = document.getElementById('brushSize');
		const eyedropperBtn = document.getElementById('eyedropperBtn');
		const clearBtn = document.getElementById('clearBtn');
		const eraserBtn = document.getElementById('eraserBtn');

		let isDrawing = false;
		let lastX = 0;
		let lastY = 0;
		let isEyedropperActive = false;
		let symmetry = true;
		let isErasing = false;

		ctx.imageSmoothingEnabled = false;
		ctx.willReadFrequently = true;

		colorPicker.addEventListener('input', () => {
			ctx.strokeStyle = colorPicker.value;
		});

		backgroundPicker.addEventListener('input', () => {
			bgCtx.fillStyle = backgroundPicker.value;
			bgCtx.fillRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
		});

		drawingCanvas.addEventListener('pointerdown', startDrawing);
		drawingCanvas.addEventListener('pointermove', draw);
		drawingCanvas.addEventListener('pointerup', stopDrawing);
		drawingCanvas.addEventListener('pointerout', stopDrawing);
		drawingCanvas.addEventListener('pointercancel', stopDrawing);

		symmetryButton.addEventListener('click', toggleSymmetry);

		function saveState() {
			history.push(ctx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height));
			redoHistory = [];
		}

		function startDrawing(e) {
			isDrawing = true;
			[lastX, lastY] = [e.offsetX, e.offsetY];
		}

		function draw(e) {
			if (!isDrawing) return;

			e.preventDefault();
			const rect = drawingCanvas.getBoundingClientRect();
			const x = e.clientX - rect.left;
			const y = e.clientY - rect.top;
			const pressure = e.pressure || 1;

			ctx.lineWidth = brushSizeInput.value * pressure;
			ctx.lineCap = 'round';
			ctx.lineJoin = 'round';

			if (isErasing) {
				ctx.globalCompositeOperation = 'destination-out';
			} else {
				ctx.globalCompositeOperation = 'source-over';
				ctx.strokeStyle = colorPicker.value;
			}

			ctx.beginPath();
			ctx.moveTo(lastX, lastY);
			ctx.lineTo(x, y);
			ctx.stroke();

			if (symmetry) {
				const centerX = drawingCanvas.width / 2;
				const symmetricX = 2 * centerX - x;

				ctx.beginPath();
				ctx.moveTo(2 * centerX - lastX, lastY);
				ctx.lineTo(symmetricX, y);
				ctx.stroke();
			}

			[lastX, lastY] = [x, y];
		}


		function stopDrawing() {
			if (isDrawing) {
				isDrawing = false;
				saveState();
			}
		}

		function toggleSymmetry() {
			symmetry = !symmetry;
			symmetryButton.classList.toggle('active', symmetry);
		}

		document.addEventListener('DOMContentLoaded', () => {
			const cursorPanel = document.getElementById('cursorPanel');
			const cursorList = document.getElementById('cursorList');
			const changeCursorBtn = document.getElementById('changeCursorBtn');

			function loadCursors() {
				cursorList.innerHTML = '';
				for (let i = 1; i <= 1000; i++) {
					const cursorUrl = `cursors/${i}.png`;

					const image = new Image();
					image.src = cursorUrl;
					image.onload = () => {

						let targetWidth = image.width;
						let targetHeight = image.height;


						const maxSize = 64;

						if (targetWidth > maxSize || targetHeight > maxSize) {
							const aspectRatio = targetWidth / targetHeight;
							if (targetWidth > targetHeight) {
								targetWidth = maxSize;
								targetHeight = maxSize / aspectRatio;
							} else {
								targetHeight = maxSize;
								targetWidth = maxSize * aspectRatio;
							}
						}

						const canvas = document.createElement('canvas');
						const ctx = canvas.getContext('2d');
						canvas.width = targetWidth;
						canvas.height = targetHeight;
						ctx.drawImage(image, 0, 0, targetWidth, targetHeight);
						const resizedCursorUrl = canvas.toDataURL();


						const cursorImg = document.createElement('img');
						cursorImg.src = resizedCursorUrl;
						cursorImg.alt = `cursor${i}`;
						cursorImg.style.maxWidth = `${maxSize}px`;

						cursorImg.addEventListener('click', () => {
							drawingCanvas.style.cursor = `url(${resizedCursorUrl}), auto`;
							cursorPanel.style.display = 'none';
						});

						cursorList.appendChild(cursorImg);
					};
				}
			}

			changeCursorBtn.addEventListener('click', () => {
				cursorPanel.style.display = cursorPanel.style.display === 'none' ? 'block' : 'none';
			});

			loadCursors();
		});

		eyedropperBtn.addEventListener('click', toggleEyedropper);

		function toggleEyedropper() {
			isEyedropperActive = !isEyedropperActive;
			eyedropperBtn.classList.toggle('active', isEyedropperActive);

			if (isEyedropperActive) {
				drawingCanvas.style.cursor = 'url(cursors/4.png), auto';
			} else {
				drawingCanvas.style.cursor = 'default';
			}
		}

		drawingCanvas.addEventListener('click', (e) => {
			if (isEyedropperActive) {
				const rect = drawingCanvas.getBoundingClientRect();
				const x = e.clientX - rect.left;
				const y = e.clientY - rect.top;
				const pixelData = ctx.getImageData(x, y, 1, 1).data;
				const color = `rgb(${pixelData[0]}, ${pixelData[1]}, ${pixelData[2]})`;

				colorPicker.value = color;
				ctx.strokeStyle = color;

				isEyedropperActive = false;
				drawingCanvas.style.cursor = 'default';
			}
		});

		let history = [];
		let redoHistory = [];

		document.getElementById('undo').addEventListener('click', () => {
			if (history.length > 0) {
				redoHistory.push(history.pop());
				const previousState = history[history.length - 1];
				ctx.putImageData(previousState, 0, 0);
			}
		});

		document.getElementById('redo').addEventListener('click', () => {
			if (redoHistory.length > 0) {
				history.push(redoHistory.pop());
				const nextState = history[history.length - 1];
				ctx.putImageData(nextState, 0, 0);
			}
		});

		clearBtn.addEventListener('click', () => {
			ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
			saveState();
		});

		eraserBtn.addEventListener('click', () => {
			isErasing = !isErasing;
			eraserBtn.classList.toggle('active', isErasing);


			if (isErasing) {
				drawingCanvas.style.cursor = 'url(cursors/2.png), auto';
			} else {
				drawingCanvas.style.cursor = 'default';
			}
		});

// –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö –∏–∫–æ–Ω–æ–∫
document.addEventListener('DOMContentLoaded', () => {
  const icons = document.querySelectorAll('a, button'); 
  icons.forEach(icon => {
    icon.classList.add('icon-hover');
  });
});

const slider = document.getElementById("brushSize"); // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
const output = document.getElementById("rangeValue");
output.innerHTML = slider.value; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ

slider.oninput = function() {
  output.innerHTML = this.value;
  const percent = (this.value - this.min) / (this.max - this.min); // –í—ã—á–∏—Å–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç
  const left = percent * (sliderWidth - output.offsetWidth); // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–ª–µ–≤–∞
  output.style.left = left + 'px'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–ª–µ–≤–∞
}


	</script>
	<script  src="cancer.js" defer></script>
	<script type="module" src="cancerSettings.js" defer></script>
	<script type="module" src="cancerHelper.js" defer></script>
	<script type="module" src="cancerHotkey.js" defer></script>
</body>

</html>