<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draw</title>
    <link rel="stylesheet" href="cancer.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.5/jscolor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="cancerCursors.js" defer></script>
    <style>
        #drawingCanvas { cursor: url('cursors/1.png'), auto; }
        #backgroundCanvas { 	

            background-image: url('./images/bg.jpg');
        }

    </style>
</head>
<body>
    <main class="base-container">
        <aside class="sidebar" style="z-index: 10;">
            <a href="../index.html" target="_self" title="Ğ’Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· ĞºĞ¾Ğ¼Ğ°Ğ½Ñ‚Ñ‹" id="exitLink" style="font-size: 50px;">ğŸšª</a>
            <div id="message-container" style="display: none;">
                <p id="message"></p>
            </div>
            <button id="undo" title="ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ (Z)">âŸ²</button>
            <button id="redo" title="ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ (X)">âŸ³</button>
            <button id="symmetry" title="Ğ¡Ğ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ (S)">ğŸ¦‹</button>
            <button id="eyedropperBtn" title="ĞŸĞ¸Ğ¿ĞµÑ‚ĞºĞ° Ğ·Ğ°Ğ»Ğ¸Ğ²ĞºĞ¸ (A)">ğŸ’§</button>
            <button id="changeCursorBtn" title="Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ĞºÑƒÑ€ÑĞ¾Ñ€">ğŸ¨</button>
            <button id="clearBtn" title="ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ">ğŸ’€</button>
            <button id="saveImageBtn" title="Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ">ğŸ’¾</button>
            <button id="eraserBtn" title="Ğ¡Ñ‚ĞµÑ€ĞºĞ°">ğŸ§½</button>
        </aside>
        <div class="canvas-and-sliders">
            <div class="canvas-container">
                <div class="color-picker-group">
                    <input type="color" id="colorPicker" value="#000000" title="Ğ¦Ğ²ĞµÑ‚ Ğ·Ğ°Ğ»Ğ¸Ğ²ĞºĞ¸ (C)">
                    <input type="color" id="backgroundPicker" value="#ffffff" title="Ğ¦Ğ²ĞµÑ‚ Ñ„Ğ¾Ğ½Ğ° (B)">
                    <button id="previousWord" title="ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ ÑĞ»Ğ¾Ğ²Ğ¾">&lt;</button>
                    <p id="Quizz"></p>
                    <button id="nextWord" title="Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰ĞµĞµ ÑĞ»Ğ¾Ğ²Ğ¾">&gt;</button>
                    <div id="elapsedTime" class="time"></div>
                </div>
                <div class="canv-container">
                    <canvas id="backgroundCanvas" width="700" height="500" style="width:700px;height:500px; position: absolute; z-index: -1;"></canvas>
                    <canvas id="drawingCanvas" width="700" height="500" style="width:700px;height:500px;"></canvas>
                    <div id="cursorPanel" class="cursor-panel" style="display: none;">
                        <div id="cursorList"></div>
                    </div>
                </div>
            </div>
            <div class="slider-group">
                <div class="slider">
                    <div class="pressure-bar" id="pressureBar"></div>
                    <label for="brushSize" title="Ğ Ğ°Ğ·Ğ¼ĞµÑ€ ĞºĞ¸ÑÑ‚Ğ¸">ğŸ–Œï¸</label>
                    <input type="range" id="brushSize" min="1" max="100" value="3">
                    <span class="slider-value" id="rangeValue">3</span>
                </div>
            </div>
        </div>
    </main>
    <script>
        const colorPicker = document.getElementById('colorPicker');
        const backgroundPicker = document.getElementById('backgroundPicker');
        const drawingCanvas = document.getElementById('drawingCanvas');
        const backgroundCanvas = document.getElementById('backgroundCanvas');
        const ctx = drawingCanvas.getContext('2d');
        const bgCtx = backgroundCanvas.getContext('2d');
        const symmetryButton = document.getElementById('symmetry');
        const brushSizeInput = document.getElementById('brushSize');
        const eyedropperBtn = document.getElementById('eyedropperBtn');
        const clearBtn = document.getElementById('clearBtn');
        const eraserBtn = document.getElementById('eraserBtn');
        const undoBtn = document.getElementById('undo');
        const redoBtn = document.getElementById('redo');
        const saveImageBtn = document.getElementById('saveImageBtn');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let isEyedropperActive = false;
        let symmetry = true;
        let isErasing = false;
        let history = [];
        let redoHistory = [];

        ctx.imageSmoothingEnabled = false;
        ctx.willReadFrequently = true;

function initializeCanvas() {
    const backgroundImage = new Image();
    backgroundImage.src = '/images/bg.jpg'; // Path to your background image
    backgroundImage.onload = () => {
        bgCtx.drawImage(backgroundImage, 0, 0, backgroundCanvas.width, backgroundCanvas.height);
    };
    saveState();
}

        function saveState() {
            history.push(ctx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height));
            redoHistory = [];
            updateUndoRedoButtons();
        }

        function updateUndoRedoButtons() {
            undoBtn.disabled = history.length <= 1;
            redoBtn.disabled = redoHistory.length === 0;
        }

        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const rect = drawingCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const pressure = e.pressure || 1;

            ctx.lineWidth = brushSizeInput.value * pressure;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (isErasing) {
                ctx.globalCompositeOperation = 'destination-out';
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = colorPicker.value;
            }

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();

            if (symmetry) {
                const centerX = drawingCanvas.width / 2;
                const symmetricX = 2 * centerX - x;
                ctx.beginPath();
                ctx.moveTo(2 * centerX - lastX, lastY);
                ctx.lineTo(symmetricX, y);
                ctx.stroke();
            }

            [lastX, lastY] = [x, y];
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveState();
            }
        }

        function toggleSymmetry() {
            symmetry = !symmetry;
            symmetryButton.classList.toggle('active', symmetry);
        }

        function undo() {
            if (history.length > 1) {
                redoHistory.push(history.pop());
                ctx.putImageData(history[history.length - 1], 0, 0);
                updateUndoRedoButtons();
            }
        }

        function redo() {
            if (redoHistory.length > 0) {
                const state = redoHistory.pop();
                history.push(state);
                ctx.putImageData(state, 0, 0);
                updateUndoRedoButtons();
            }
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
            saveState();
        }

        function toggleEraser() {
            isErasing = !isErasing;
            eraserBtn.classList.toggle('active', isErasing);
            drawingCanvas.style.cursor = isErasing ? 'url(cursors/2.png), auto' : 'default';
        }

        function saveImage() {
            const link = document.createElement('a');
            link.download = 'my-drawing.png';
            link.href = drawingCanvas.toDataURL('image/png');
            link.click();
        }

        function resizeCanvas() {
            const rect = backgroundCanvas.getBoundingClientRect();
            backgroundCanvas.width = rect.width * devicePixelRatio;
            backgroundCanvas.height = rect.height * devicePixelRatio;
            drawingCanvas.width = rect.width * devicePixelRatio;
            drawingCanvas.height = rect.height * devicePixelRatio;
            ctx.scale(devicePixelRatio, devicePixelRatio);
            bgCtx.scale(devicePixelRatio, devicePixelRatio);
            initializeCanvas();
        }

        // Event Listeners
        colorPicker.addEventListener('input', () => ctx.strokeStyle = colorPicker.value);
        backgroundPicker.addEventListener('input', () => {
            bgCtx.fillStyle = backgroundPicker.value;
            bgCtx.fillRect(0, 0, backgroundCanvas.width, backgroundCanvas.height);
        });
        drawingCanvas.addEventListener('pointerdown', startDrawing);
        drawingCanvas.addEventListener('pointermove', draw);
        drawingCanvas.addEventListener('pointerup', stopDrawing);
        drawingCanvas.addEventListener('pointerout', stopDrawing);
        drawingCanvas.addEventListener('pointercancel', stopDrawing);
        symmetryButton.addEventListener('click', toggleSymmetry);
        undoBtn.addEventListener('click', undo);
        redoBtn.addEventListener('click', redo);
        clearBtn.addEventListener('click', clearCanvas);
        eraserBtn.addEventListener('click', toggleEraser);
        saveImageBtn.addEventListener('click', saveImage);
        window.addEventListener('resize', resizeCanvas);

        // Initialize
        initializeCanvas();
        resizeCanvas();

        // Add class for nice icons
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('a, button').forEach(icon => icon.classList.add('icon-hover'));
        });

        // Check for pointer events support
        if (window.PointerEvent) {
            console.log('Pointer events are supported');
        } else {
            console.log('Pointer events are not supported');
        }
    </script>
    <script src="cancer.js" defer></script>
    <script type="module" src="cancerSettings.js" defer></script>
    <script type="module" src="cancerHelper.js" defer></script>
    <script type="module" src="cancerHotkey.js" defer></script>
</body>
</html>
